// Type definitions for request-debug 0.2
// Project: https://github.com/request/request-debug
// Definitions by: Marcello Urbani <https://github.com/marcellourbani>

export = request_debug

import { CoreOptions, Headers, Request, RequestAPI, RequiredUriUrl } from "request"

declare namespace request_debug {
  type LogPhase = "request" | "response" | "redirect" | "auth"
  // same as request's main export
  type request = RequestAPI<Request, CoreOptions, RequiredUriUrl>

  // type LogType = "request" | "response" | "redirect" | "auth"
  interface RequestData {
    debugId: number
    method: string
    uri: string
    headers: Headers
    body?: any
  }

  interface ResponseData {
    debugId: number
    headers: Headers
    statusCode: number
    body?: any
  }

  interface RedirectData {
    debugId: number
    headers: Headers
    statusCode: number
    uri: string
  }
  type LogData = RequestData | ResponseData | RedirectData

  interface LogCallback {
    (type: "request", data: RequestData, r: request): void
  }
  interface LogCallback {
    (type: "response", data: ResponseData, r: request): void
  }
  interface LogCallback {
    (type: "redirect" | "auth", data: RedirectData, r: request): void
  }
  interface LogCallback {
    (type: LogPhase, data: LogData, r: request): void
  }

  type Debug = (request: request, log?: LogCallback) => void

  const log: LogCallback
}

declare function request_debug(
  request: request_debug.request,
  cb: request_debug.LogCallback
): void
